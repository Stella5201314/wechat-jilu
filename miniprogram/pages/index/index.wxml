<view class="page">
  <header-nav title="灵材智库"></header-nav>

  <view class="container">
    <view class="main-row">
      <writing-sidebar
        bind:submit="onSidebarSubmit"
        bind:aiSuggest="onAiSuggest"
      ></writing-sidebar>

      <view class="content">
        <view class="toolbar toolbar--space">
          <view class="toolbar-left">
            <!-- 标签行：每个标签旁放一个小信息图标，点击会弹出该标签的说明 -->
            <view class="tag-row">
              <block wx:for="{{tagPool}}" wx:key="name">
                <view class="{{item.selected ? 'chip chip--active' : 'chip'}}" data-name="{{item.name}}" bindtap="toggleTag">
                  <text class="chip-text">{{item.name}}</text>
                  <image src="/assets/icons/info.png" class="chip-info" data-name="{{item.name}}" bindtap="onTagInfoTap" />
                </view>
              </block>
            </view>
          </view>

          <view class="toolbar-right">
            <view class="btn-plain small" bindtap="fetchMaterials">刷新</view>
            <view class="btn-plain small" bindtap="onAiSuggest">灵感</view>
          </view>
        </view>

        <view class="material-list">
          <block wx:for="{{materials}}" wx:key="_id">
            <material-card
              material="{{item}}"
              bind:view="onViewMaterial"
              bind:select="onSelectMaterial"
            ></material-card>
          </block>
        </view>

        <view class="generate-wrap">
          <view class="btn-primary large" bindtap="onGeneratePrompt">生成 Prompt</view>
        </view>
      </view>
    </view>
  </view>

  <prompt-preview
    visible="{{promptVisible}}"
    prompt="{{currentPrompt}}"
    bind:close="onClosePrompt"
  ></prompt-preview>

  <bottom-tabs current="home"></bottom-tabs>
</view>